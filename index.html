<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="nailong.png">
    <title>Happy Birthday Jhaeivy</title>
    <style>
        body {
            background-color: #1a1a2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #dcdcdc;
            font-family: 'Courier New', Courier, monospace;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            width: 640px;
            height: 480px;
            border: 4px solid #2a1b3d;
            background-color: #000;
            box-shadow: 0 0 60px rgba(122, 76, 138, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }

        @media only screen and (max-width: 700px) {
            #game-container {
                width: 96vw;
                height: auto;
                aspect-ratio: 4/3;
            }
            canvas {
                width: 100% !important;
                height: 100% !important;
            }
            #dialogue-box {
                height: 75px !important;
                bottom: 10px !important;
                padding: 8px 10px !important;
                font-size: 8px !important;
                line-height: 1.3 !important;
                border-width: 2px !important;
            }
            .name-tag {
                font-size: 11px !important;
                margin-bottom: 2px !important;
                letter-spacing: 1px !important;
            }
        }

        canvas {
            display: block;
            image-rendering: pixelated;
        }

        #dialogue-box {
            position: absolute;
            bottom: 20px;
            left: 5%;
            width: 90%;
            height: 120px;
            background-color: rgba(20, 15, 30, 0.95);
            border: 3px solid #b388eb;
            border-radius: 10px;
            box-sizing: border-box;
            padding: 14px 18px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            line-height: 1.5;
            color: #fff;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
            z-index: 10;
        }

        .name-tag {
            font-size: 18px;
            font-weight: bold;
            display: block;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0px #000;
        }

        h1 {
            font-size: 16px;
            letter-spacing: 4px;
            margin-bottom: 15px;
            color: #b388eb;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(179, 136, 235, 0.5);
        }

        #mobile-controls {
            display: none;
            width: 100%;
            height: 180px;
            position: fixed;
            bottom: 0;
            left: 0;
            padding-bottom: 20px;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
            z-index: 100;
        }

        @media (max-width: 900px) {
            #mobile-controls { display: flex; }
            #instructions { font-size: 10px; }
        }

        .control-group {
            pointer-events: auto;
            display: flex;
            gap: 15px;
            padding: 20px;
        }

        .dpad-btn, .action-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
            border: 2px solid rgba(179, 136, 235, 0.5);
            color: white;
            border-radius: 50%;
            touch-action: manipulation;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: transform 0.1s, background 0.1s;
        }

        .dpad-btn:active, .action-btn:active {
            transform: scale(0.9);
            background: rgba(179, 136, 235, 0.4);
        }

        .dpad-btn { width: 60px; height: 60px; }
        .action-btn {
            width: 70px; height: 70px;
            background: rgba(179, 136, 235, 0.2);
            border-color: #ff99aa;
            color: #ff99aa;
        }
    </style>
</head>
<body>
<audio id="bgMusic" src="softspot.mp3" loop></audio>
    <h1>Project: Honey Butter</h1>
    <div id="game-container">
        <canvas id="gameCanvas" width="640" height="480"></canvas>
        <div id="dialogue-box">
            <span id="text-content"></span>
        </div>
    </div>
    <p style="font-size: 14px; margin-top: 15px; color: #a0a0c0;">
        <span id="instructions">Press <strong>SPACE</strong> to start</span>
    </p>

    <div id="mobile-controls">
        <div class="control-group">
            <div class="dpad-btn" id="btn-left">◀</div>
            <div class="dpad-btn" id="btn-right">▶</div>
        </div>
        <div class="control-group">
            <div class="action-btn" id="btn-action">A</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        const bgMusic = document.getElementById('bgMusic');
        let musicStarted = false;

        function startMusic() {
            if (!musicStarted) {
                bgMusic.play().then(() => {
                    console.log("Music started!");
                    musicStarted = true;
                    removeGlobalListeners();
                }).catch(e => {
                    console.log('Audio blocked:', e);
                });
            }
        }

        function removeGlobalListeners() {
            window.removeEventListener('click', startMusic);
            window.removeEventListener('keydown', startMusic);
            window.removeEventListener('touchstart', startMusic);
        }

        window.addEventListener('click', startMusic);
        window.addEventListener('keydown', startMusic);
        window.addEventListener('touchstart', startMusic);

        const dBox = document.getElementById('dialogue-box');
        const textContent = document.getElementById('text-content');
        const instructions = document.getElementById('instructions');

        const talkingBgImg = new Image(); talkingBgImg.src = 'bg_talking.gif';
        const fherClosed = new Image(); fherClosed.src = 'fher.png';
        const fherOpen = new Image();   fherOpen.src = 'fher_talking.png';
        const jhaeivyClosed = new Image(); jhaeivyClosed.src = 'jhaeivy.png';
        const jhaeivyOpen = new Image();   jhaeivyOpen.src = 'jhaeivy_talking.png';

        // --- GLOBAL IMAGE LOADING (SMART FALLBACK v2) ---
        const usImages = [];
        const totalImages = 31;

        for (let i = 1; i <= totalImages; i++) {
            // 1. Skip files you know don't exist
            if (i === 4 || i === 16 || i === 24) continue;

            const img = new Image();
            
            // 2. Start by trying the lowercase version
            img.src = `pics/img${i}.jpg`; 

            // 3. Success Handler
            img.onload = () => {
                usImages.push(img);
                console.log(`✅ Loaded: ${img.src}`);
            };

            // 4. Error Handler (CRASH FIXED HERE)
            img.onerror = () => {
                // We use 'img.src' instead of 'this.src' to be safe
                if (img.src.includes('.jpg')) {
                    // It failed on .jpg, so let's try .JPG
                    console.log(`⚠️ img${i}.jpg failed, trying uppercase .JPG...`);
                    img.src = `pics/img${i}.JPG`;
                } else {
                    // It failed on .JPG too, so it's truly gone.
                    console.log(`❌ Skipped completely missing file: img${i}`);
                }
            };
        }

        const script = [
            { speaker: "Jhaeivy", text: "Hi, Fher!" },
            { speaker: "Fher", text: "Jhaeivy... you made it." },
            { speaker: "Fher", text: "It's beautiful out here tonight, isn't it?" },
            { speaker: "Jhaeivy", text: "It is!" },
            { speaker: "Fher", text: "Listen, today is your birthday..." },
            { speaker: "Fher", text: "So, I wrote this just for you." },
            { speaker: "Fher", text: "If loving you were an experiment,\nI'd run it infinite times..." },
            { speaker: "Fher", text: "I'd record every variable,\nanalyze every reaction..." },
            { speaker: "Fher", text: "and still find the constant:\nme, drawn to you, inevitably." },
            { speaker: "Fher", text: "Your presence is my optimal medium,\nmy heart the agar..." },
            { speaker: "Fher", text: "...your love the nutrient\nthat allows me to thrive." },
            { speaker: "Fher", text: "If this is a chemical reaction,\nlet me dissolve..." },
            { speaker: "Fher", text: "until all that remains\nis the part of me\nthat binds to you, always." },
            { speaker: "Fher", text: "You're where my heart thrives." },
            { speaker: "Fher", text: "Happy birthday, my honey butter. I Love You <3" }
        ];

        let scriptIndex = 0;
        let isTalking = false;
        let isTyping = false;
        let charIndex = 0;
        let typingInterval;
        let animationFrame = 0;
        let hearts = [];

        let gameState = 'menu';
        let creditsScroll = 0;
        let creditsShapes = [];

        let particles = [];
        let fireflies = [];
        let shootingStars = [];
        let grassBlades = [];

        const stars = Array.from({length: 100}, () => ({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height * 0.6,
            size: Math.random() * 2 + 1,
            blinkSpeed: Math.random() * 0.1 + 0.02,
            brightness: Math.random()
        }));
        const clouds = [
            {x: 50, y: 80, w: 100, h: 40, speed: 0.1},
            {x: 450, y: 120, w: 140, h: 50, speed: 0.15},
            {x: 250, y: 50, w: 80, h: 30, speed: 0.08}
        ];

        const fher = { x: 480, y: 360, w: 32, h: 48, color: '#2e8b57', facing: 'left', idleAnim: 0, emoteTimer: 0 };
        const jhaeivy = { x: 100, y: 360, w: 32, h: 48, color: '#ff99aa', speed: 2, facing: 'right', isMoving: false, idleAnim: 0 };
        const keys = {};

        for (let i = 0; i < 15; i++) {
            fireflies.push({
                x: Math.random() * canvas.width,
                y: Math.random() * (canvas.height * 0.7),
                vx: (Math.random() - 0.5) * 0.5, vy: (Math.random() - 0.5) * 0.5,
                brightness: Math.random(), glowPhase: Math.random() * Math.PI * 2
            });
        }

        for (let i = 0; i < canvas.width; i += 4) {
            grassBlades.push({
                x: i, y: 400, h: 4 + Math.random() * 6,
                swaySpeed: 0.001 + Math.random() * 0.002, swayPhase: Math.random() * Math.PI * 2
            });
        }

        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (e.code === 'Space') {
                if (gameState === 'menu') {
                    gameState = 'playing';
                    instructions.innerHTML = 'Use <strong>Arrow Keys</strong> to move Jhaeivy.<br>Walk to Fher and press <strong>SPACE</strong>.';
                } else if (gameState === 'playing') {
                    if (!isTalking) checkInteraction();
                    else nextLine();
                } else if (gameState === 'credits' && creditsScroll > 2000) {
                    gameState = 'menu';
                    creditsScroll = 0;
                    scriptIndex = 0;
                    creditsShapes = [];
                    hearts = [];
                    jhaeivy.x = 100;
                    jhaeivy.y = 360;
                    instructions.innerHTML = 'Press <strong>SPACE</strong> to start';
                }
            }
        });
        window.addEventListener('keyup', (e) => { keys[e.code] = false; });

        function checkInteraction() {
            const dist = Math.hypot(fher.x - jhaeivy.x, fher.y - jhaeivy.y);
            if (dist < 80) {
                isTalking = true;
                dBox.style.display = 'block';
                typeLine();
            }
        }

        function typeLine() {
            textContent.innerHTML = "";
            charIndex = 0;
            clearInterval(typingInterval);
            isTyping = true;
            const currentLine = script[scriptIndex].text;
            const speaker = script[scriptIndex].speaker;
            const nameColor = speaker === 'Fher' ? '#88ffcc' : '#ffbbcc';
            textContent.innerHTML = `<span class="name-tag" style="color:${nameColor};">${speaker}</span>`;
            typingInterval = setInterval(() => {
                textContent.innerHTML += currentLine.charAt(charIndex);
                charIndex++;
                if (charIndex >= currentLine.length) {
                    clearInterval(typingInterval);
                    isTyping = false;
                }
            }, 100);
        }

        function nextLine() {
            if (charIndex < script[scriptIndex].text.length) {
                const speaker = script[scriptIndex].speaker;
                const nameColor = speaker === 'Fher' ? '#88ffcc' : '#ffbbcc';
                textContent.innerHTML = `<span class="name-tag" style="color:${nameColor};">${speaker}</span>` + script[scriptIndex].text;
                charIndex = script[scriptIndex].text.length;
                clearInterval(typingInterval);
                isTyping = false;
                return;
            }
            scriptIndex++;
            if (scriptIndex < script.length) {
                typeLine();
            } else {
                isTalking = false;
                dBox.style.display = 'none';
                gameState = 'credits';
                initCredits();
            }
        }

        function createParticle(x, y) {
            particles.push({
                x: x, y: y, vx: (Math.random() - 0.5) * 2, vy: -Math.random() * 2 - 1, life: 1,
                size: Math.random() * 3 + 1, color: Math.random() > 0.5 ? '#ff99aa' : '#ffccaa'
            });
        }

        function update() {
            if (gameState === 'menu' || gameState === 'credits') return;
            if (isTalking) {
                if (Math.random() < 0.05) {
                    hearts.push({
                        x: Math.random() * canvas.width, y: canvas.height + 10,
                        speed: 0.5 + Math.random(), size: 2 + Math.random() * 4, opacity: 1
                    });
                }
                for (let i = hearts.length - 1; i >= 0; i--) {
                    hearts[i].y -= hearts[i].speed;
                    hearts[i].opacity -= 0.005;
                    if (hearts[i].opacity <= 0) hearts.splice(i, 1);
                }
                return;
            }
            clouds.forEach(cloud => {
                cloud.x += cloud.speed;
                if (cloud.x > canvas.width) cloud.x = -cloud.w;
            });
            if (Math.random() < 0.003) {
                 shootingStars.push({
                     x: Math.random() * canvas.width + 100, y: Math.random() * canvas.height / 3,
                     vx: -4 - Math.random() * 2, vy: 1 + Math.random(), len: 30 + Math.random() * 20, life: 1.0
                 });
            }
            for (let i = shootingStars.length - 1; i >= 0; i--) {
                let ss = shootingStars[i];
                ss.x += ss.vx; ss.y += ss.vy; ss.life -= 0.015;
                if (ss.life <= 0 || ss.x + ss.len < 0) shootingStars.splice(i, 1);
            }
            fireflies.forEach(firefly => {
                firefly.x += firefly.vx; firefly.y += firefly.vy; firefly.glowPhase += 0.05;
                if (firefly.x < 0 || firefly.x > canvas.width) firefly.vx *= -1;
                if (firefly.y < 0 || firefly.y > canvas.height * 0.7) firefly.vy *= -1;
                if (Math.random() < 0.02) {
                    firefly.vx += (Math.random() - 0.5) * 0.2;
                    firefly.vy += (Math.random() - 0.5) * 0.2;
                }
            });
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].vx; particles[i].y += particles[i].vy;
                particles[i].life -= 0.02; particles[i].vy += 0.1;
                if (particles[i].life <= 0) particles.splice(i, 1);
            }
            fher.idleAnim += 0.05; fher.emoteTimer++; jhaeivy.idleAnim += 0.05;
            jhaeivy.isMoving = false;
            let moved = false;
            if (keys['ArrowLeft'] && jhaeivy.x > 0) {
                jhaeivy.x -= jhaeivy.speed; jhaeivy.facing = 'left'; jhaeivy.isMoving = true; moved = true;
            }
            if (keys['ArrowRight'] && jhaeivy.x < canvas.width - jhaeivy.w) {
                jhaeivy.x += jhaeivy.speed; jhaeivy.facing = 'right'; jhaeivy.isMoving = true; moved = true;
            }
            if (jhaeivy.isMoving) {
                animationFrame++;
                if (animationFrame % 8 === 0) {
                    createParticle(jhaeivy.x + 16, jhaeivy.y + 48);
                }
            }
        }

        function initCredits() {
            creditsScroll = 0;
            creditsShapes = [];
            for (let i = 0; i < 30; i++) {
                spawnRandomShape();
            }
        }

        let lastImageIndex = -1;

        // --- FIXED SPAWN FUNCTION: Uses the global usImages list ---
        function spawnRandomShape() {
            let types = ['heart', 'flower', 'star', 'sparkle'];

            if (usImages.length > 0) {
                 types.push('image', 'image', 'image');
            }

            const type = types[Math.floor(Math.random() * types.length)];

            const shape = {
                type: type,
                x: 40 + Math.random() * (canvas.width - 80),
                rotation: Math.random() * Math.PI * 2,
                rotSpeed: (Math.random() - 0.5) * 0.02,
            };

            if (type === 'image') {
                shape.y = canvas.height + 50 + Math.random() * 150;
                shape.speed = 0.4 + Math.random() * 0.4;

                let index = Math.floor(Math.random() * usImages.length);
                if (usImages.length > 1 && index === lastImageIndex) {
                    index = (index + 1) % usImages.length;
                }
                lastImageIndex = index;

                shape.img = usImages[index];
                shape.size = 30 + Math.random() * 30;
                shape.opacity = 0.8 + Math.random() * 0.2;
                shape.isMovingUp = true;
            } else {
                shape.y = Math.random() * canvas.height;
                shape.size = 10 + Math.random() * 20;
                shape.opacity = 0.3 + Math.random() * 0.5;
                shape.color = ['#ff99aa', '#ffccaa', '#b388eb', '#88ffcc'][Math.floor(Math.random() * 4)];
                shape.isMovingUp = false;
            }

            creditsShapes.push(shape);
        }

        function drawShape(shape) {
            ctx.save();
            ctx.globalAlpha = shape.opacity;
            ctx.translate(shape.x, shape.y);
            ctx.rotate(shape.rotation);
            const s = shape.size;

            if (shape.type === 'image') {
                if(shape.img.complete) {
                    ctx.fillStyle = "#ffffff";
                    ctx.fillRect(-s/2 - 2, -s/2 - 2, s + 4, s + 4);
                    ctx.drawImage(shape.img, -s/2, -s/2, s, s);
                }
            } else if (shape.type === 'heart') {
                ctx.fillStyle = shape.color;
                ctx.beginPath();
                ctx.moveTo(0, s * 0.3);
                ctx.bezierCurveTo(-s * 0.5, -s * 0.3, -s * 0.8, s * 0.2, 0, s * 0.8);
                ctx.bezierCurveTo(s * 0.8, s * 0.2, s * 0.5, -s * 0.3, 0, s * 0.3);
                ctx.fill();
            } else if (shape.type === 'flower') {
                ctx.fillStyle = shape.color;
                for (let i = 0; i < 5; i++) {
                    ctx.beginPath();
                    ctx.arc(Math.cos(i * Math.PI * 2 / 5) * s * 0.4,
                           Math.sin(i * Math.PI * 2 / 5) * s * 0.4,
                           s * 0.3, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(0, 0, s * 0.2, 0, Math.PI * 2);
                ctx.fill();
            } else if (shape.type === 'star') {
                ctx.fillStyle = shape.color;
                ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = (i * Math.PI * 2) / 5 - Math.PI / 2;
                    const x = Math.cos(angle) * s * 0.5;
                    const y = Math.sin(angle) * s * 0.5;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                    const innerAngle = angle + Math.PI / 5;
                    const ix = Math.cos(innerAngle) * s * 0.2;
                    const iy = Math.sin(innerAngle) * s * 0.2;
                    ctx.lineTo(ix, iy);
                }
                ctx.closePath();
                ctx.fill();
            } else if (shape.type === 'sparkle') {
                ctx.strokeStyle = shape.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(-s * 0.5, 0);
                ctx.lineTo(s * 0.5, 0);
                ctx.moveTo(0, -s * 0.5);
                ctx.lineTo(0, s * 0.5);
                ctx.stroke();
            }
            ctx.restore();
        }

        function updateCredits() {
            creditsScroll += 1;
            if (Math.random() < 0.03) spawnRandomShape();
            for (let i = creditsShapes.length - 1; i >= 0; i--) {
                let shape = creditsShapes[i];
                shape.rotation += shape.rotSpeed;
                if (shape.isMovingUp) shape.y -= shape.speed;
                if (creditsShapes.length > 60 && !shape.isMovingUp) {
                    creditsShapes.splice(i, 1);
                } else if (shape.isMovingUp && shape.y < -150) {
                    creditsShapes.splice(i, 1);
                }
            }
        }

        // --- DRAW FUNCTION ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (gameState === 'menu') {
                drawMenu();
                return;
            }

            if (gameState === 'credits') {
                updateCredits();
                drawCredits();
                return;
            }

            if (isTalking) {
                // Background
                if (talkingBgImg.complete && talkingBgImg.naturalWidth !== 0) {
                    ctx.drawImage(talkingBgImg, 0, 0, canvas.width, canvas.height);
                } else {
                    ctx.fillStyle = "#2a1b3d"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // Stars overlay
                ctx.fillStyle = "#fff";
                stars.forEach(star => {
                    ctx.globalAlpha = 0.6 + Math.sin(Date.now() * star.blinkSpeed) * 0.4;
                    ctx.fillRect(star.x, star.y, star.size, star.size);
                });
                ctx.globalAlpha = 1.0;

                // Floating Hearts
                hearts.forEach(h => {
                    ctx.fillStyle = `rgba(255, 150, 180, ${h.opacity})`;
                    ctx.fillRect(h.x, h.y, h.size, h.size);
                    ctx.fillRect(h.x-h.size, h.y-h.size, h.size, h.size);
                    ctx.fillRect(h.x+h.size, h.y-h.size, h.size, h.size);
                    ctx.fillRect(h.x, h.y-h.size*2, h.size, h.size);
                });

                const imgW = 200; const imgH = 250;
                const speaker = script[scriptIndex].speaker;

                // Async Animation Logic
                const fherTick = Math.floor(Date.now() / 700) % 2 === 0;
                const fherAnimating = (speaker === "Fher" && isTyping && fherTick);
                let fherCurrent = fherAnimating ? fherOpen : fherClosed;

                if (fherClosed.complete) ctx.drawImage(fherCurrent, 50, 100, imgW, imgH);

                const jhaeivyTick = Math.floor(Date.now() / 2000) % 2 === 0;
                let jhaeivyCurrent = jhaeivyTick ? jhaeivyOpen : jhaeivyClosed;

                if (jhaeivyClosed.complete) ctx.drawImage(jhaeivyCurrent, 390, 100, imgW, imgH);

            } else {
                // Exploration Mode
                drawScenery();

                // Draw Particles
                particles.forEach(p => {
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.life;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                });
                ctx.globalAlpha = 1.0;

                drawPixelChar(fher, 'fher');
                drawPixelChar(jhaeivy, 'jhaeivy');

                // Nametags
                ctx.fillStyle = "#fff";
                ctx.font = "10px Courier New";
                ctx.fillText("Fher", fher.x + 2, fher.y - 8);
                ctx.fillText("Jhaeivy", jhaeivy.x - 2, jhaeivy.y - 8);
            }
        }

        function drawMenu() {
            const skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGrad.addColorStop(0, "#2a1b3d");
            skyGrad.addColorStop(0.6, "#4d3169");
            skyGrad.addColorStop(1, "#7a4c8a");
            ctx.fillStyle = skyGrad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#ffffff";
            stars.forEach(star => {
                ctx.globalAlpha = 0.6 + Math.sin(Date.now() * star.blinkSpeed) * 0.4;
                ctx.fillRect(star.x, star.y, star.size, star.size);
            });
            ctx.globalAlpha = 1.0;
            ctx.fillStyle = "#b388eb";
            ctx.font = "bold 48px 'Courier New'";
            ctx.textAlign = "center";
            ctx.shadowColor = "rgba(179, 136, 235, 0.8)";
            ctx.shadowBlur = 20;
            ctx.fillText("PROJECT:", canvas.width / 2, 150);
            ctx.fillText("HONEY BUTTER", canvas.width / 2, 210);
            ctx.shadowBlur = 0;
            ctx.fillStyle = "#ff99aa";
            ctx.font = "24px 'Courier New'";
            ctx.fillText("A Birthday Message", canvas.width / 2, 260);
            const pulse = Math.sin(Date.now() * 0.003) * 10;
            ctx.fillStyle = "#ff99aa";
            ctx.font = "40px Arial";
            ctx.fillText("♥", canvas.width / 2 - 60, 320 + pulse);
            ctx.fillText("♥", canvas.width / 2 + 60, 320 - pulse);
            ctx.fillStyle = "#dcdcdc";
            ctx.font = "20px 'Courier New'";
            const blink = Math.floor(Date.now() / 500) % 2;
            if (blink) {
                ctx.fillText("Press SPACE to start", canvas.width / 2, 400);
            }
            ctx.textAlign = "left";
        }

        function drawCredits() {
            const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            grad.addColorStop(0, "#1a1a2e");
            grad.addColorStop(1, "#2a1b3d");
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            creditsShapes.forEach(shape => drawShape(shape));
            ctx.fillStyle = "#ffffff";
            ctx.textAlign = "center";
            ctx.shadowColor = "rgba(0, 0, 0, 0.8)";
            ctx.shadowBlur = 10;
            const credits = [
                { text: "PROJECT: HONEY BUTTER", size: 32, color: "#b388eb", offset: 0 },
                { text: "", size: 20, color: "#fff", offset: 60 },
                { text: "Created with Love for", size: 24, color: "#ff99aa", offset: 100 },
                { text: "JHAEIVY", size: 40, color: "#ffccaa", offset: 160 },
                { text: "", size: 20, color: "#fff", offset: 220 },
                { text: "Written & Programmed by", size: 20, color: "#88ffcc", offset: 280 },
                { text: "FHER", size: 32, color: "#88ffcc", offset: 330 },
                { text: "", size: 20, color: "#fff", offset: 390 },
                { text: "Character Design", size: 20, color: "#b388eb", offset: 450 },
                { text: "Fher & Jhaeivy", size: 24, color: "#dcdcdc", offset: 490 },
                { text: "", size: 20, color: "#fff", offset: 550 },
                { text: "Special Thanks", size: 20, color: "#ff99aa", offset: 610 },
                { text: "To every moment we've shared", size: 18, color: "#dcdcdc", offset: 650 },
                { text: "To every laugh and smile", size: 18, color: "#dcdcdc", offset: 680 },
                { text: "To the future ahead of us", size: 18, color: "#dcdcdc", offset: 710 },
                { text: "", size: 20, color: "#fff", offset: 770 },
                { text: "♥", size: 48, color: "#ff99aa", offset: 850 },
                { text: "", size: 20, color: "#fff", offset: 920 },
                { text: "Happy Birthday, Jhaeivy!", size: 36, color: "#ffccaa", offset: 1000 },
                { text: "I Love You <3", size: 24, color: "#ff99aa", offset: 1060 },
                { text: "", size: 20, color: "#fff", offset: 1120 },
                { text: "Thank you for being you", size: 20, color: "#dcdcdc", offset: 1200 },
                { text: "♥ ♥ ♥", size: 40, color: "#ff99aa", offset: 1280 }
            ];
            credits.forEach(line => {
                const y = canvas.height - creditsScroll + line.offset;
                if (y > -50 && y < canvas.height + 50) {
                    ctx.font = `${line.size}px 'Courier New'`;
                    ctx.fillStyle = line.color;
                    ctx.fillText(line.text, canvas.width / 2, y);
                }
            });
            ctx.shadowBlur = 0;
            if (creditsScroll > 2000) {
                ctx.fillStyle = "#dcdcdc";
                ctx.font = "18px 'Courier New'";
                const blink = Math.floor(Date.now() / 500) % 2;
                if (blink) {
                    ctx.fillText("Press SPACE to return to menu", canvas.width / 2, canvas.height - 30);
                }
            }
            ctx.textAlign = "left";
        }

        // --- MOBILE CONTROLS LOGIC ---
        function simulateKey(code, type) {
            const event = new KeyboardEvent(type, {
                key: code === 'Space' ? ' ' : code,
                code: code,
                bubbles: true
            });
            window.dispatchEvent(event);
        }

        const btnLeft = document.getElementById('btn-left');
        const btnRight = document.getElementById('btn-right');
        const btnAction = document.getElementById('btn-action');

        function bindTouch(btn, code) {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                simulateKey(code, 'keydown');
            });
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                simulateKey(code, 'keyup');
            });
            btn.addEventListener('mousedown', (e) => {
                simulateKey(code, 'keydown');
            });
            btn.addEventListener('mouseup', (e) => {
                simulateKey(code, 'keyup');
            });
        }

        bindTouch(btnLeft, 'ArrowLeft');
        bindTouch(btnRight, 'ArrowRight');
        bindTouch(btnAction, 'Space');

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();

    </script>
</body>
</html>
